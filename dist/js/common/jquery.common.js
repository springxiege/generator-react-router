!function(e,o,n){n.extend({setTokenForPC:function(o,n){if(e.sessionStorage){var t={token:o,userinfo:n,time:(new Date).getTime()};e.sessionStorage.setItem("trade",JSON.stringify(t))}},LoginAndGrantAuthorization:function(){var o=function(e){var o;if(e){var n=location.href.indexOf("?");if(n==-1)return{};o=location.href.substr(n+1)}else o=location.search.substr(1);var t={};return o.split("&").forEach(function(e){if(e){e=e.split("+").join(" ");var o=e.indexOf("="),n=o>-1?e.substr(0,o):e,i=o>-1?decodeURIComponent(e.substr(o+1)):"",a=n.indexOf("[");if(a==-1)t[decodeURIComponent(n)]=i;else{var r=n.indexOf("]"),s=decodeURIComponent(n.substring(a+1,r));n=decodeURIComponent(n.substring(0,a)),t[n]||(t[n]=[]),s?t[n][s]=i:t[n].push(i)}}}),t};if(e.config.isWX){var t=o(e.location.href);t.currentUrl=e.location.origin+e.location.pathname,n.ajax({url:config.hosts+"/token",type:"GET",dataType:"json",data:t,error:function(e){console.log(e)},success:function(o){if(o.code)e.location.href=o.data.redirectUrl;else{var n=o.data.token,t=o.data.expire;e.config.head=n,e.config.tokenExpire=t-1>0?t-1:0;var i={token:n,userinfo:o.data.data,time:(new Date).getTime};e.sessionStorage.setItem("trade",JSON.stringify(i))}}})}else{var i=e.location.hash.replace("#","").replace(/\?.{0,}/gi,"").toLowerCase(),a=["","/","register","productdetails","allgoods"],r=!0;if(n.each(a,function(e,o){if(i.indexOf(o)>=0)return r=!1,!1}),!r)return!1;e.location.hash="#/Register"+i}},refreshToken:function(o){config.flag&&(config.flag=!1,n.ajax({url:config.url+"/auth/refresh/?v="+100*Math.random()+"&token="+config.head,type:"GET",dataType:"json",data:{},error:function(o){401===o.status&&1===o.responseJSON.code&&(e.config.isWX?n.LoginAndGrantAuthorization():e.location.hash="#/Register")},success:function(n){if(config.flag=!0,0===parseInt(n.code)){var t=JSON.parse(e.sessionStorage.getItem("trade"));t.time=(new Date).getTime,t.token=n.data.token,e.sessionStorage.setItem("trade",JSON.stringify(t)),config.head=n.data.token,o&&o(n.data)}if(1===parseInt(n.code)&&(alert("刷新token失败，请重新登录"),!config.isWX)){var i=e.location.hash;i=i.replace("#","").replace(/\?.{1,}/gi,""),e.location.hash="#/Register"+i}}}))},tips:function(e,o,t){var i='<div class="pop-error" id="pop-error">'+e+"</div>";0===n("#pop-error").length&&n("body").append(i);var a=n("#pop-error"),r=a.outerWidth(!0);a.css({"margin-left":-(r/2)}),setTimeout(function(){a.animate({opacity:0},o||1200,function(){t&&"function"==typeof t&&t(),a.remove()})},o||1200)},loadingtips:function(e,o){if("show"==e||1==e||1==e){var t='<div class="pop-error" id="pop-error">'+o+"</div>";0===n("#pop-error").length&&n("body").append(t);var i=n("#pop-error"),a=i.outerWidth(!0);i.css({"margin-left":-(a/2)})}if("hide"==e||0==e||0==e){var i=n("#pop-error");i.remove()}},confirm:function(e){var o=n.extend(!0,{},{titleclsName:"",contentclsName:"",remove:!0,init:null,title:"",content:"确认信息",time:0,CancelBtn:null,okBtn:null},e),t='<div class="pop-btns clearfix"><span class="pop-btn-cancle fl">取消</span><span class="pop-btn-ok fr">确认</span></div>';t='<div class="pop-btns clearfix"><span class="pop-btn-ok pop-btn-block">确认</span></div>';var i='<div class="pop-confirm ask" id="pop-confirm"><div class="pop-container"><div class="pop-main"><i class="pop-btn-close"></i><div class="pop-content '+o.contentclsName+'">'+o.content+"</div>"+t+"</div></div></div>";""!=o.title&&(i='<div class="pop-confirm ask" id="pop-confirm"><div class="pop-container"><div class="pop-main"><i class="pop-btn-close"></i><div class="pop-title '+o.titleclsName+'">'+o.title+'</div><div class="pop-content '+o.contentclsName+'">'+o.content+"</div>"+t+"</div></div></div>"),0===n("#pop-confirm").length&&n("body").append(i);var a=n("#pop-confirm"),r=a.find(".pop-main").height();if(o.init&&"function"==typeof o.init&&o.init(a),a.find(".pop-main").css({"margin-top":-(r/2)}),a.on("click touchend",".pop-btn-close,.pop-btn-cancle",function(e){return o.CancelBtn&&"function"==typeof o.CancelBtn&&o.CancelBtn(),a.remove(),!1}),a.on("click touchend",".pop-btn-ok",function(e){return o.okBtn&&"function"==typeof o.okBtn&&!n(this).hasClass("disabled")&&(o.okBtn(a),o.remove&&a.remove()),!1}),o.time)var s=o.time,c=setInterval(function(){0==s?(clearInterval(c),c=null,a.find(".pop-btn-ok").html("确认").removeClass("disabled")):a.find(".pop-btn-ok").html("确认("+s--+")")},1e3);else a.find(".pop-btn-ok").removeClass("disabled")},loading:{show:function(){n("#mobi_page_loading").length?n("#mobi_page_loading").show():n("body").append('<div id="mobi_page_loading"></div>')},hide:function(){n("#mobi_page_loading").remove()}}})}(window,void 0,jQuery);